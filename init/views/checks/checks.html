{{extend 'layout.html'}}
{{include '../static/jslib.html'}}
{{include 'box.html'}}
{{include 'panel.html'}}
{{include 'filters.html'}}
{{include 'lib.html'}}
{{
initialize_keys()
now = datetime.datetime.now()
deadline = now - datetime.timedelta(days=1)
def outdated(t):
     if t is None: return True
     if t < deadline: return True
     return False
pass

}}

<a id="listdiv" class="xinfo"><span><div ondblclick="getElementById('listdiv').className='xinfo';" id='listspan'>innerHTML here</div></span></a>
{{=PANEL("column_values")}}
<form action='checks' name='svcform' id='svcform' method='post'>
{{=DB_FILTERS_TABLE(active_filters, available_filters)}}
<table class=datatable>
  <tr class=box>
    <td></td>
    {{for key in colkeys:}}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}}">
      {{=colname(checks, key, columns[key]['title'], nestedin=columns[key]['nestedin'])}}
    </td>
    {{pass}}
  </tr>
  <tr class=box>
    <td><input type=checkbox id=check_all onClick="select_all(document.getElementById('check_all').checked, document.getElementById('svcform'))"></td>
    {{for key in colkeys:}}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}}"><input name={{=key}} value='{{=request.vars[key]}}' size={{=columns[key]['size']}} onKeyPress="checkEnter(event)"></td>
    {{pass}}
  </tr>
  {{
    cellclass = 'cell1'
    cellclasses = {'cell1': 'cell2', 'cell2': 'cell1'}
  }}
  {{for check in checks:
      cellclass = cellclasses[cellclass]

      checked = getattr(request.vars, 'check_'+str(check.v_checks.id))
      if checked is not None:
          checked = 'checked=on'
          pass

  }}
  <tr class={{=cellclass}}>
    <td class={{=cellclass}}><input type=checkbox name=check_{{=check.v_checks.id}} {{=checked}}></td>
    {{for key in colkeys:}}
    {{table = columns[key]['nestedin']}}

    {{if key == 'chk_svcname':}}
    <td name="tcol_chk_id" style="{{=col_hide('chk_svcname')}}" ondblclick="svcform.chk_svcname.value='{{=check.v_checks.chk_svcname}}';svcform.submit()">
      {{=DIV(
          A(
            check.v_checks.chk_svcname,
            _onclick="""
               getElementById("node").value="%(node)s";
               getElementById("rowid").value="%(id)s";
               ajax("%(url)s",['node', 'rowid'],"id_%(id)s");
               show_eid("tr_id_%(id)s");
            """%dict(url=URL(r=request,c='default',f='ajax_service'),
                     node=check.v_checks.chk_svcname,
                     id=check.v_checks.id,
                    ),
          ),
          _class="xinfo",
        )
      }}
    {{elif key == 'chk_nodename':}}
    <td name="tcol_chk_id" style="{{=col_hide('chk_nodename')}}" ondblclick="svcform.chk_nodename.value='{{=check.v_checks.chk_nodename}}';svcform.submit()">
      {{=DIV(
          node_icon(check.v_nodes.os_name),
          A(
            check.v_checks.chk_nodename,
            _onclick="""
               getElementById("node").value="%(node)s";
               getElementById("rowid").value="%(id)s";
               ajax("%(url)s",['node', 'rowid'],"id_%(id)s");
               show_eid("tr_id_%(id)s");
            """%dict(url=URL(r=request,c='ajax_node',f='ajax_node'),
                     node=check.v_checks.chk_nodename,
                     id=check.v_checks.id,
                    ),
          ),
          _class="xinfo",
        )
      }}
    </td>
    {{elif key == 'chk_value':
         if check.v_checks.chk_value < check.v_checks.chk_low or check.v_checks.chk_value > check.v_checks.chk_high:
             alert = 'color:darkred;font-weight:bold'
         else:
             alert = ''
         pass
    }}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}};{{=alert}}" ondblclick="svcform.{{=key}}.value='{{=check[table][key]}}';svcform.submit()">{{=check[table][key]}}</td>
    {{elif key == 'chk_low':
         if check[table]['chk_value'] < check[table]['chk_low']:
             alert = 'color:darkred;font-weight:bold'
         else:
             alert = ''
         pass
    }}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}};{{=alert}}" ondblclick="svcform.{{=key}}.value='{{=check[table][key]}}';svcform.submit()">{{=check[table][key]}}</td>
    {{elif key == 'chk_high':
         if check[table]['chk_value'] > check[table]['chk_high']:
             alert = 'color:darkred;font-weight:bold'
         else:
             alert = ''
         pass
    }}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}};{{=alert}}" ondblclick="svcform.{{=key}}.value='{{=check[table][key]}}';svcform.submit()">{{=check[table][key]}}</td>
    {{elif key == 'chk_updated':
         if outdated(check[table]['chk_updated']):
             alert = 'color:darkred;font-weight:bold'
         else:
             alert = ''
         pass
    }}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}};{{=alert}}" ondblclick="svcform.{{=key}}.value='{{=check[table][key]}}';svcform.submit()">{{=check[table][key]}}</td>
    {{elif key == 'chk_type':}}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}}" ondblclick="svcform.{{=key}}.value='{{=check[table][key]}}';svcform.submit()">{{=A(check[table][key], _href=URL(r=request, c='checks', f='checks_defaults_insert', vars={'chk_type':check[table][key]}))}}</td>
    {{else:}}
    <td name="tcol_{{=key}}" style="{{=col_hide(key)}}" ondblclick="svcform.{{=key}}.value='{{=check[table][key]}}';svcform.submit()">{{=check[table][key]}}</td>
    {{pass}}
    {{pass}}
  </tr>
  <tr id='tr_id_{{=check.v_checks.id}}' class="cloud">
    <td colspan=99 class="details_row {{=cellclass}}">
      <div id='id_{{=check.v_checks.id}}'>
      </div>
    </td>
  </tr>
  {{pass}}
  <tr class=box>
    <td align=center colspan=99>{{=nav}}</td>
  </tr>
  <tr class=box>
    <td colspan=99>
      <table>
        <tr>
          <td> {{=T('Export')}}:</td>
          <td> {{=T('Set low thresholds')}}:</td>
          <td> {{=T('Set high thresholds')}}:</td>
          <td> {{=T('Reset thresholds')}}:</td>
        </tr>
        <tr>
          <td>
            {{=A(IMG(_src=URL(r=request,c='static',f='csv.png'),_border=0, _title=T("print the csv representation of the current data cursor")),_href=URL(r=request,f='checks_csv', vars=request.vars))}}
          </td>
          <td>
            {{=IMG(
                 _src=URL(r=request,c='static',f='add.png'),
                 _border=0,
                 _title=T('set the low alert thresholds for the current data cursor'),
                 _onclick="""svcform.action.value="set_low_thres";
                             show_eid("inputs");
                             document.svcform.val.focus();
                          """
               )
            }}
          </td>
          <td>
            {{=IMG(
                 _src=URL(r=request,c='static',f='add.png'),
                 _border=0,
                 _title=T('set the high alert thresholds for the current data cursor'),
                 _onclick="""svcform.action.value="set_high_thres";
                             show_eid("inputs");
                             document.svcform.val.focus();
                          """
               )
            }}
          </td>
          <td>
            {{=IMG(
                 _src=URL(r=request,c='static',f='del.png'),
                 _border=0,
                 _title=T('reset the high and low alert thresholds for the current data cursor'),
                 _onclick="""svcform.action.value="reset";
                             document.svcform.submit();
                          """
               )
            }}
          </td>
        </tr>
        <tr class=hidden id="inputs">
          <td></td>
          <td>
            {{=T('New threshold value')}}:<br>
            <input name=val onKeyPress="checkEnter(event)" onBlur="getElementById('action').value='';hide_eid('inputs')">
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<input id="node" type="hidden">
<input id="rowid" type="hidden">
<input name="action" type="hidden">
</form>
