{{
from gluon.serializers import json_parser, custom_json

def json(value, default=custom_json):
    # replace JavaScript incompatible spacing
    # http://timelessrepo.com/json-isnt-a-javascript-subset
    return json_parser.dumps(value, indent=4, default=default).replace(ur'\u2028', '\\u2028').replace(ur'\2029', '\\u2029')

try:
    response.write(json(response._vars),escape=False)
    response.headers['Content-Type']='text/json'
except Exception as e:
    raise HTTP(405,'no json: %s'%str(e))
pass
}}
